import * as _ from './actionsTypes';
import BASE_URL from './BASE_URL';

export const loggedInAction = (value) => ({ type: _.LOGGED_IN, value });
export const clearToken = () => ({ type: _.CLEAR_TOKEN, value: undefined });

const requestToken = () => ({ type: _.REQUEST_TOKEN });
const receiveToken = (token) => ({
  type: _.RECEIVE_TOKEN,
  token,
});

/**
* Token API requests.
* @typedef Token
* @summary Send object with the data request to the redux state.
* @param {{username: string, password: string}} user {username: '', password: ***}
*/
export function fetchToken(user) {
  const URL = `${BASE_URL}/api-token-auth/`;

  return async (dispatch) => {
    dispatch(requestToken());
    const response = await fetch(URL, {
      method: 'post',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(user),
      redirect: 'follow',
    });
    const token = await response.json();
    return dispatch(receiveToken(token));
  };
}
