import React, { useEffect } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import CardHosts from '../../components/cards/hosts';
import CardRisk from '../../components/cards/risk';
import CardVulnerabilities from '../../components/cards/vulnerabilities';
import ChartTop10 from '../../components/charts/top10';
import ChartVulnerabilities from '../../components/charts/vulnerabilities';
import Header from '../../components/Header';
import SideBar from '../../components/SideBar';
import { fetchCards, fetchCharts, fetchHosts } from '../../redux/actions';
import fetchVulnerabilities from '../../redux/actions/vulnerabilities';
import Style from './dashboard.module.css';

function Dashboard() {
  const { token } = useSelector((state) => state.login);
  const dispatch = useDispatch();

  useEffect(() => {
    function getData() {
      dispatch(fetchHosts(token));
      dispatch(fetchVulnerabilities(token));

      dispatch(fetchCards(token, 'total_hosts'));
      dispatch(fetchCards(token, 'total_vulnerabilities'));
      dispatch(fetchCards(token, 'average_risk'));

      dispatch(fetchCharts(token, 'severity'));
      dispatch(fetchCharts(token, 'top_assets'));
    }
    getData();
  }, []);

  return (
    <div className={Style.container}>
      <Header />
      <SideBar />
      <div className={Style.wrapper}>
        <section className={Style.dashboard}>
          <div className={Style.cards_container}>
            <CardHosts />
            <CardVulnerabilities />
            <CardRisk />
          </div>
          <div className={Style.charts_container}>
            <ChartVulnerabilities />
            <ChartTop10 />
          </div>
        </section>
      </div>
    </div>
  );
}

export default Dashboard;
