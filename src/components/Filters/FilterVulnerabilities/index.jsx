import React from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { RiFilterOffFill, RiFilterFill } from 'react-icons/ri';
import fetchVulnerabilities, { fetchByHosts, fetchBySeverity } from '../../../redux/actions/vulnerabilities';
import Style from '../Filter.module.css';

function FilterVulnerabilities() {
  const token = useSelector((state) => state.login.token);
  const dispatch = useDispatch();
  const hosts = useSelector((state) => state.data.hosts.results);

  const handleChange = ({ target }) => {
    dispatch(fetchBySeverity(token, target.value));
  };

  const handleHosts = ({ target }) => {
    dispatch(fetchByHosts(token, target.value));
  };

  const handleClear = () => {
    dispatch(fetchVulnerabilities(token));
  };

  return (
    <div className={Style.container}>
      <div className={Style.clear}>
        <RiFilterFill />
        <label htmlFor="severity">
          <select
            className="form-control"
            name="severity"
            id="severity"
            onChange={handleChange}
          >
            <option value="">Gravidade</option>
            <option value={1}>Baixo</option>
            <option value={2}>Médio</option>
            <option value={3}>Alto</option>
            <option value={4}>Crítico</option>
          </select>
        </label>
      </div>
      <div>
        <label htmlFor="hosts">
          <select
            className="form-control"
            name="hosts"
            id="hosts"
            onChange={handleHosts}
          >
            <option value="">Hosts</option>
            {
              typeof hosts !== 'undefined' && hosts.map((element) => (
                <option key={element.id} value={element.id}>{element.hostname}</option>
              ))
            }
          </select>
        </label>
      </div>
      <div className={Style.clear}>
        <RiFilterOffFill />
        <button type="button" onClick={handleClear}>
          Limpar Filtros
        </button>
      </div>
    </div>
  );
}

export default FilterVulnerabilities;
