import React, { useEffect, useState } from 'react';
import { useSelector } from 'react-redux';
import {
  Bar, BarChart, CartesianGrid, LabelList, Legend, ResponsiveContainer, Tooltip, XAxis,
  YAxis,
} from 'recharts';
import Style from '../charts.module.css';

const renderCustomizedLabel = (props) => {
  const {
    x, y, width, value,
  } = props;
  const radius = 10;

  return (
    <g>
      <circle cx={x + width / 2} cy={y - radius} r={radius} fill="#8884d8" />
      <text x={x + width / 2} y={y - radius} fill="#fff" textAnchor="middle" dominantBaseline="middle">
        {value}
      </text>
    </g>
  );
};

function ChartTop10() {
  const [data, setData] = useState([]);
  const dataTopAssets = useSelector((state) => state.data.chartTopAssets);

  useEffect(() => {
    const newData = dataTopAssets
      .map((element, index) => ({
        name: element.host,
        vulnerabilidades: element.vuln_count,
        rank: index + 1,
      }));
    setData(newData);
  }, [dataTopAssets]);

  return (
    <div className={Style.container}>
      <h1>Top 10 hosts mais vulner√°veis</h1>
      {
        data && (
          <ResponsiveContainer width="100%" height="100%">
            <BarChart
              width={500}
              height={250}
              data={data}
              margin={{
                top: 20,
                right: 100,
                left: 20,
                bottom: 5,
              }}
            >
              <CartesianGrid />
              <XAxis dataKey="name" interval="preserveStartEnd" dx={20} />
              <YAxis />
              <Tooltip />
              <Legend />
              <Bar dataKey="vulnerabilidades" fill="#8884d8" minPointSize={5}>
                <LabelList dataKey="rank" content={renderCustomizedLabel} />
              </Bar>
            </BarChart>
          </ResponsiveContainer>
        )
      }
    </div>
  );
}

export default ChartTop10;
