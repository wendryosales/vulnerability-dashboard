import { RECEIVE_VULNERABILITIES, REQUEST_VULNERABILITIES } from './actionsTypes';
import BASE_URL from './BASE_URL';

const requestVulnerabilities = () => ({ type: REQUEST_VULNERABILITIES });
const receiveVulnerabilities = (vulnerabilities) => ({
  type: RECEIVE_VULNERABILITIES,
  value: vulnerabilities,
});

/**
* Vulnerabilities API requests. you can sort the results. Default: random.
* @param {string} token
* @summary Send object with the data request to the redux state.
* @param {string} order options: 'title', 'severity', 'cvss', 'asset_count' Default: random,
* @param {string} urlApi you can set a new URL for this request
*/
export default function fetchVulnerabilities(token, order, urlApi) {
  let URL = `${BASE_URL}/api/vulnerabilities/`;
  if (order) URL = `${BASE_URL}/api/vulnerabilities/?ordering=${order}`;
  if (urlApi) URL = urlApi;
  return async (dispatch) => {
    dispatch(requestVulnerabilities());
    const response = await fetch(URL, {
      method: 'get',
      headers: {
        Authorization: `Token ${token}`,
      },
    });
    const vulnerabilities = await response.json();
    return dispatch(receiveVulnerabilities(vulnerabilities));
  };
}
