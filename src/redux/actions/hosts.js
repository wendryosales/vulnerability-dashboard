import * as _ from './actionsTypes';
import BASE_URL from './BASE_URL';

const requestHosts = () => ({ type: _.REQUEST_HOSTS });
const receiveHosts = (hosts) => ({
  type: _.RECEIVE_HOSTS,
  hosts,
});

/**
* Hosts API requests. you can sort the results. Default: random.
* @param {string} token
* @summary Send object with the data request to the redux state.
* @param {string} order options: 'hostname', 'ip_address', 'vuln_count,
*/
export default function fetchHosts(token, order) {
  const URL = `${BASE_URL}/api/assets/?ordering=${order}`;
  return async (dispatch) => {
    dispatch(requestHosts());
    const response = await fetch(URL, {
      method: 'get',
      headers: {
        Authorization: `Token ${token}`,
      },
    });
    const hosts = await response.json();
    return dispatch(receiveHosts(hosts));
  };
}

const requestHostsByVulnerabilities = () => ({ type: _.REQUEST_HOSTS_BY_VULNERABILITIES });
const receiveHostsByVulnerabilities = (hosts) => ({
  type: _.RECEIVE_HOSTS_BY_VULNERABILITIES,
  hosts,
});

/**
* Hosts By Vulnerability API requests.
* @summary Send object with the data request to the redux state.
* @param {string} token
* @param {number} id Vulnerability ID.
*/
export function fetchHostsByVulnerabilities(token, id) {
  const URL = `${BASE_URL}/api/assets/?vulnerability=${id}`;
  return async (dispatch) => {
    dispatch(requestHostsByVulnerabilities());
    const response = await fetch(URL, {
      method: 'get',
      headers: {
        Authorization: `Token ${token}`,
      },
    });
    const hosts = await response.json();
    return dispatch(receiveHostsByVulnerabilities(hosts));
  };
}

const requestHostsDetails = () => ({ type: _.REQUEST_HOST_DETAILS });
const receiveHostsDetails = (hostDetails) => ({
  type: _.RECEIVE_HOST_DETAILS,
  hostDetails,
});

/**
* Hosts Details API requests.
* @param {string} token
* @summary Send object with the data request to the redux state.
* @param {string} id Host ID
*/
export function fetchHostsDetails(token, id) {
  const URL = `${BASE_URL}/api/assets/${id}`;
  return async (dispatch) => {
    dispatch(requestHostsDetails());
    const response = await fetch(URL, {
      method: 'get',
      headers: {
        Authorization: `Token ${token}`,
      },
    });
    const hostDetails = await response.json();
    return dispatch(receiveHostsDetails(hostDetails));
  };
}
